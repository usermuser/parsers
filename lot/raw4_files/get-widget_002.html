<!DOCTYPE html>
<html lang="en"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"><style type="text/css">@charset "UTF-8";[ng\:cloak],[ng-cloak],[data-ng-cloak],[x-ng-cloak],.ng-cloak,.x-ng-cloak,.ng-hide{display:none !important;}ng\:form{display:block;}.ng-animate-block-transitions{transition:0s all!important;-webkit-transition:0s all!important;}.ng-hide-add-active,.ng-hide-remove{display:block!important;}</style>
  <!-- перевод IE в режим Edge (chrome = 1 не нужен) : stackoverflow.com/a/22059516/6056120 -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta charset="UTF-8">  
  <title>Widget popup</title>
  
  <!-- шрифт с внешнего источника типа гугл фонтс -->
  <link href="get-widget_data_002/css.css" rel="stylesheet">
  <!-- <link rel="stylesheet" href="style1.css"> -->

  <!-- jQuery -->
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>     -->

  <style type="text/css">

    * {
      border: 0;
      margin: 0;
      padding: 0;
      outline: 0;
      box-sizing: border-box;
      font-family: 'Roboto', sans-serif; /* не везде каскадируется поэтому лучше здесь */
    }

    body {
      /*outline: 1px blue dashed;*/
      width: 650px;            
      /*height: 500px;*/
      overflow:hidden;
      padding: 5px;
    }

    .container {    
      position: relative;       
      width: 636px;
      height: 171px;
      box-shadow: 0 0 11px 1px rgba(0, 0, 0, 0.24);
      background-color: #fac900;      
      padding: 15px 10px 10px 256px;
    }    
    
    #container-2 {
      padding-top: 10px;
      height: 141px;
    }

    #close {
      position: absolute;
      top: 0px;
      right: 5px;
      cursor: pointer;
    }
    
    .people {
      position: absolute;
      bottom: 0;
      left: 10px;
    }
    
    .button {
      display: inline-block;
      width: 162px;
      height: 35px;
      border-radius: 4px;
      background-color: #249925;
      line-height: 35px;
      text-align: center;
      font-weight: 400;
      color: #fff;
      font-size: 14px;
    }       

    #text3 {    
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 5px;
    }

    #text4 {
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 15px;
    }

    #text5 {    
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 3px;
    }

    #text6 {
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 10px;
    }
    
    #email {
      width: 192px;
      height: 35px;
      border-radius: 4px;
      border: 1px solid #cfa600;
      background-color: #ffffff;
      color: #9a9a9a;      
      font-size: 14px;
      font-weight: 400;
      padding: 0 10px;
      margin-right: 5px;

    }

    #button2 {
      margin-bottom: 16px;
    }

    #terms-link {
      font-size: 12px;
      color: #444;
      text-decoration: underline;
      position: relative;
      top: -5px;
    }
   
  /* ЛОГИКА и фрагменты чужого кода */
    #relative-input-container {
      position: relative;
    }

    .Error {
      display: none;
      font-size: 10px;
      position: absolute;
      bottom: -4px;
      padding: 5px 0;
      text-align: left;
      opacity: .9;
      left: 12px;
      font-weight: 100;
      line-height: 11px;
      z-index: 100;
    }
    .Error-inner {
      padding: 5px 6px 4px 5px;
      text-align: center;
      color: #fff;
      background-color: #000; }

    .Error-arrow {
      position: absolute;
      top: 0px;
      left: 0;
      width: 0;
      height: 0;
      border-width: 6px 5px 0;
      border-style: solid;
      border-color: transparent;
      border-left-color: #000;
    }
    
    /* -------------- служебные классы --------------- */
    
    .wrong {
      /*border-color: red !important;*/
      border: 1px solid red !important;
    }

    .correct {
      border-color: green !important;
    }

    /* всё что кликается (кнопки, чекбоксы) */
    .clickable:active {
      position: relative;
      top: 1px;
      left: 1px;
    }

    .clickable:hover {
      opacity: .8;
      cursor: pointer;
    }       
    
    .unselectable-text {
      /* запрет выделения текста, полезно в кнопках и лейблах полей */       
      -webkit-user-select: none;
      -moz-user-select: none;
      -khtml-user-select: none;
      -ms-user-select: none;
    }
    
    .no-wrap {
      /* спан класс запрет переноса для цен с пробелом у разрядов */
      white-space: nowrap;      
      font-family: inherit;
      color: inherit;
      font-size: inherit;
      font-weight: inherit;
    }

    .invisible {
      display: none;
    }

  </style>

</head>
<body>  
  
  <div class="container" id="container-1" fl-screen="login">
    <div id="close" fl-close="" fl-track-ga="click-close-login"><img src="get-widget_data_002/b93fe7d1-065d-4fe0-abe3-c7ceb87dc00e_close2.png" class="clickable"></div>
    <img class="people" src="get-widget_data_002/1b364410-9df2-4002-b8f7-35a6e97e9376_bg02.png">
    <div id="text3">Не упускайте шанс стать миллионером!</div>
    <div id="text4">Оставьте свой email и вы не пропустите<br>ни одного розыгрыша суперприза!</div>
    <div id="relative-input-container">
      <input id="email" placeholder="Введите ваш email" type="text">
      <div class="button clickable js-click-submit" id="button2">Стать миллионером</div>
      <div fl-login-form-error="email" class="Error">
        <div class="Error-arrow"></div>
        <div class="Error-inner">Проверьте корректность e-mail</div>
      </div>
    </div>
    <div id="terms-link" class="clickable unselectable-text js-click-terms">Пользовательское соглашение</div>
  </div>

  <div class="container" id="container-2" fl-screen="thank-you">
    <div id="close" fl-close="" fl-track-ga="click-close-login"><img src="get-widget_data_002/b93fe7d1-065d-4fe0-abe3-c7ceb87dc00e_close2.png" class="clickable"></div>
    <img class="people" src="get-widget_data_002/1b364410-9df2-4002-b8f7-35a6e97e9376_bg02.png">
    <div id="text5">Спасибо за подписку</div>
    <div id="text6">Подтвердите, пожалуйста, свой e-mail, перейдя по ссылке из письма, которое мы выслали на указанный вами адрес.</div>    
    <div class="button clickable" fl-close="" fl-track-ga="click-close-thank-you" id="button2">Закрыть</div>      
  </div>

  <div class="container" id="container-2" fl-screen="terms">
    <div id="close" fl-close="" fl-track-ga="close-agreement"><img src="get-widget_data_002/b93fe7d1-065d-4fe0-abe3-c7ceb87dc00e_close2.png" class="clickable"></div>
     <img class="people" src="get-widget_data_002/1b364410-9df2-4002-b8f7-35a6e97e9376_bg02.png"> 
    <div id="text5">Пользовательское соглашение</div>
    <div id="text6">Нажимая на кнопку "Стать миллионером" и заполняя 
настоящую форму, я даю согласие на получение информационных материалов 
от stoloto.ru</div>    
    <div class="button clickable js-click-terms-back" fl-track-ga="click-button-back" id="button2">Назад</div>      
  </div>

  <script type="text/javascript" src="get-widget_data_003/bridge.js"></script>   
  <script> 

    bridge.onReady(function () {
      bridge.setScreen('login'); // устанавиливаем первый экран
      bridge.positionWidget({ type: 'popup' }).then(function() {
        // Ресайзим
        return bridge.resizeWidget({ width: 640, height: 181 });
      }).then(function() {
        // Показываем
        bridge.showWidget();
      });

      $ = bridge.$;
    // });

    // $(document).ready(function() {

      var EMAIL_REGEX = /^[-a-z0-9~!$%^&*_=+}{\'?]+(\.[-a-z0-9~!$%^&*_=+}{\'?]+)*@([a-z0-9_][-a-z0-9_]*(\.[-a-z0-9_]+)*\.(aero|arpa|biz|com|coop|edu|gov|info|int|mil|museum|name|net|org|pro|travel|mobi|[a-z][a-z])|([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}))(:[0-9]{1,5})?$/i;

      function isEmailCorrect (emailValue) {
        if(EMAIL_REGEX.test(emailValue)) {
          return true
        } else {
          return false
        }
      }
      
      $(".js-click-terms").on("click", function (e) {
        bridge.resizeWidget({ width: 640, height: 151 });
        bridge.setScreen("terms");
      });
      $(".js-click-terms-back").on("click", function (e) {
        bridge.resizeWidget({ width: 640, height: 181 });
        bridge.setScreen("login");
      });

      // С помощью ручки столото проверяем, что такой email есть/нет у них в базе
      // в data приходит {Boolean} true|false
      // @return promise
      function isEmailExist(email) {
        return bridge.cc.$ajax.jsonp('/flocktory/check-mail', {email: email});
      }

      function hideErrorMsg() {
        $(".Error").fadeOut('slow');
      }

      function showErrorMsg(message) {
        var $emailErrorBlock = bridge.$('[fl-login-form-error="email"]');
        $emailErrorBlock.find('.Error-inner').text(message);
        $(".Error").fadeIn('slow', function() {setTimeout(hideErrorMsg,2000)});        
      }

      $(".js-click-submit").on("click", function (e) {
        emailValue = $.trim($("#email").val());

        if (isEmailCorrect(emailValue)) {
          isEmailExist(emailValue).then(function(isExist) {
            if (isExist) {
              showErrorMsg("Такой e-mail уже существует");
              return false;
            } else {
              bridge.login({ email: emailValue, data: {a:'b'} });
              bridge.resizeWidget({ width: 640, height: 151 });
              bridge.setScreen('thank-you');
            }
          }).fail(function () {
            showErrorMsg("Произошла ошибка, попробуйте позже");
          });
        } else {
          showErrorMsg("Проверьте корректность e-mail");
        }
      });
    });
  
  </script>

</body></html>